num_iterations = 20
batch_size = 64
num_layers = 32
num_stages = 16
use_prefetch = True
step time = 24.863731622695923
--------------- finish training step 0
0 68.13934707641602
step time = 22.984668731689453
--------------- finish training step 1
1 127.74417638778687
step time = 23.3493914604187
--------------- finish training step 2
2 189.0952832698822
step time = 20.478872299194336
--------------- finish training step 3
3 247.50443530082703
step time = 22.141541719436646
--------------- finish training step 4
4 306.92074847221375
step time = 22.200820207595825
--------------- finish training step 5
5 367.12718391418457
step time = 21.93042016029358
--------------- finish training step 6
6 426.7416923046112
step time = 21.84267282485962
--------------- finish training step 7
7 485.8287544250488
step time = 21.76569414138794
--------------- finish training step 8
8 545.2184550762177
step time = 21.302610635757446
--------------- finish training step 9
9 604.3844294548035
step time = 21.575194120407104
--------------- finish training step 10
10 663.5071449279785
step time = 21.432095050811768
--------------- finish training step 11
11 722.6437270641327
step time = 21.601568460464478
--------------- finish training step 12
12 781.7751159667969
step time = 21.758974313735962
--------------- finish training step 13
13 840.9825239181519
step time = 21.835991144180298
--------------- finish training step 14
14 900.3887033462524
step time = 22.09350562095642
--------------- finish training step 15
15 960.6304540634155
step time = 21.860145807266235
--------------- finish training step 16
16 1020.4389970302582
step time = 21.85204768180847
--------------- finish training step 17
17 1079.9416317939758
step time = 21.835456609725952
--------------- finish training step 18
18 1139.7707901000977
cuda 1: Peak memory 13.55 GB ; Persistent memory 0.55 GB
cuda 2: Peak memory 13.58 GB ; Persistent memory 0.55 GB
step time = 21.800004720687866
--------------- finish training step 19
19 1199.3761060237885
cuda 0: Peak memory 16.83 GB ; Persistent memory 3.30 GB
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   3374 MiB |  17236 MiB |   1593 GiB |   1590 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   3374 MiB |  17236 MiB |   1593 GiB |   1590 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   3374 MiB |  17115 MiB |   1588 GiB |   1585 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4002 MiB |  17936 MiB | 421928 MiB | 417926 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 642739 KiB |    883 MiB | 446635 MiB | 446007 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     197    |     787    |   73550    |   73353    |
|---------------------------------------------------------------------------|
| Active allocs         |     197    |     787    |   73550    |   73353    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     125    |     551    |   10980    |   10855    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      45    |      58    |   32272    |   32227    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

training time = 1199.3764629364014
cuda 3: Peak memory 14.03 GB ; Persistent memory 0.80 GB


num_iterations = 20
batch_size = 64
num_layers = 32
num_stages = 16
use_prefetch = False
step time = 19.516377925872803
--------------- finish training step 0
0 74.55824685096741
step time = 18.18209719657898
--------------- finish training step 1
1 136.20972180366516
step time = 18.6065993309021
--------------- finish training step 2
2 197.38808250427246
step time = 18.393953561782837
--------------- finish training step 3
3 258.9843258857727
step time = 18.51820158958435
--------------- finish training step 4
4 321.4902503490448
step time = 18.11265277862549
--------------- finish training step 5
5 382.9077935218811
step time = 18.495360374450684
--------------- finish training step 6
6 445.37020564079285
step time = 18.18320941925049
--------------- finish training step 7
7 507.059814453125
step time = 18.57143497467041
--------------- finish training step 8
8 569.9550542831421
step time = 18.128587245941162
--------------- finish training step 9
9 631.4895629882812
step time = 18.530179977416992
--------------- finish training step 10
10 694.1871271133423
step time = 18.247605562210083
--------------- finish training step 11
11 755.5223579406738
step time = 18.835952758789062
--------------- finish training step 12
12 818.6063349246979
step time = 26.69263243675232
--------------- finish training step 13
13 917.8313257694244
step time = 20.298486709594727
--------------- finish training step 14
14 987.9715349674225
step time = 20.068352699279785
--------------- finish training step 15
15 1057.7963345050812
step time = 19.626797437667847
--------------- finish training step 16
16 1125.567174911499
step time = 19.03800654411316
--------------- finish training step 17
17 1191.9485189914703
step time = 19.536311864852905
--------------- finish training step 18
18 1258.977870941162
cuda 1: Peak memory 13.55 GB ; Persistent memory 0.55 GB
cuda 2: Peak memory 13.55 GB ; Persistent memory 0.55 GB
step time = 18.995842456817627
--------------- finish training step 19
19 1324.6733400821686
cuda 0: Peak memory 16.17 GB ; Persistent memory 3.30 GB
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   3374 MiB |  16558 MiB |   1593 GiB |   1590 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   3374 MiB |  16558 MiB |   1593 GiB |   1590 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   3374 MiB |  16438 MiB |   1588 GiB |   1585 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4002 MiB |  17250 MiB | 413812 MiB | 409810 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 642739 KiB |    911 MiB | 423331 MiB | 422703 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     197    |     787    |   73550    |   73353    |
|---------------------------------------------------------------------------|
| Active allocs         |     197    |     787    |   73550    |   73353    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     125    |     538    |   10846    |   10721    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      45    |      58    |   31209    |   31164    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

training time = 1324.6737008094788
cuda 3: Peak memory 13.94 GB ; Persistent memory 0.80 GB
num_iterations = 20
batch_size = 64
num_layers = 32
num_stages = 8
use_prefetch = False
step time = 21.08063578605652
--------------- finish training step 0
0 80.2094738483429

num_iterations = 20
batch_size = 64
num_layers = 32
num_stages = 8
use_prefetch = True
offload_parallel=True
step time = 18.675775051116943
--------------- finish training step 0
0 44.61975407600403
step time = 15.529860496520996
--------------- finish training step 1
1 75.8632128238678
step time = 15.419750690460205
--------------- finish training step 2
2 107.04262399673462
step time = 15.288419246673584
--------------- finish training step 3
3 139.95732259750366
step time = 15.914733648300171
--------------- finish training step 4
4 172.97492575645447
step time = 17.275418281555176
--------------- finish training step 5
5 207.7070460319519
step time = 17.698665618896484
--------------- finish training step 6
6 242.28898644447327
step time = 17.438642501831055
--------------- finish training step 7
7 276.8655014038086
step time = 17.946666955947876
--------------- finish training step 8
8 313.2763681411743
step time = 18.066956281661987
--------------- finish training step 9
9 350.1675250530243
step time = 18.13210892677307
--------------- finish training step 10
10 385.66743659973145
step time = 17.614225149154663
--------------- finish training step 11
11 421.86288189888
step time = 17.73995804786682
--------------- finish training step 12
12 458.10243248939514
step time = 18.13353419303894
--------------- finish training step 13
13 493.3263623714447
step time = 18.168978691101074
--------------- finish training step 14
14 529.0224533081055
step time = 17.87777614593506
--------------- finish training step 15
15 565.2812049388885
step time = 17.624396800994873
--------------- finish training step 16
16 601.3664436340332
step time = 18.127846002578735
--------------- finish training step 17
17 637.271810054779
step time = 17.180988073349
--------------- finish training step 18
18 672.2906241416931
cuda 1: Peak memory 14.12 GB ; Persistent memory 0.55 GB
cuda 3: Peak memory 14.68 GB ; Persistent memory 0.80 GB
cuda 2: Peak memory 14.12 GB ; Persistent memory 0.55 GB
step time = 16.932090520858765
--------------- finish training step 19
19 706.4169690608978
cuda 0: Peak memory 16.74 GB ; Persistent memory 3.30 GB
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   3374 MiB |  17143 MiB |   1570 GiB |   1567 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   3374 MiB |  17143 MiB |   1570 GiB |   1567 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   3374 MiB |  17030 MiB |   1565 GiB |   1562 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4002 MiB |  19826 MiB | 384664 MiB | 380662 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 642739 KiB |    858 MiB | 295201 MiB | 294574 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     197    |     789    |   72710    |   72513    |
|---------------------------------------------------------------------------|
| Active allocs         |     197    |     789    |   72710    |   72513    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     152    |     596    |   10166    |   10014    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      47    |      66    |   22142    |   22095    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

training time = 706.4170227050781
num_iterations = 20
batch_size = 64
num_layers = 32
num_stages = 8
use_prefetch = True
num_iterations = 20
batch_size = 64
num_layers = 32
num_stages = 8
use_prefetch = True
num_iterations = 20
batch_size = 64
num_layers = 32
num_stages = 8
use_prefetch = True
step time = 24.710232973098755
--------------- finish training step 0
0 72.15781331062317
step time = 21.885071516036987
--------------- finish training step 1
1 133.18341493606567
step time = 25.32851767539978
--------------- finish training step 2
2 198.25091886520386
step time = 19.593878030776978
--------------- finish training step 3
3 258.63245677948
step time = 20.684062004089355
--------------- finish training step 4
4 321.7777247428894
step time = 20.418142080307007
--------------- finish training step 5
5 384.8710401058197
step time = 20.510064363479614
--------------- finish training step 6
6 447.6583638191223
step time = 20.512695789337158
--------------- finish training step 7
7 511.39996433258057
step time = 20.515226125717163
--------------- finish training step 8
8 575.8372778892517
step time = 20.16586709022522
--------------- finish training step 9
9 640.1412084102631
step time = 18.05255675315857
--------------- finish training step 10
10 700.7620093822479
step time = 17.180485486984253
--------------- finish training step 11
11 760.8219766616821
step time = 18.646287441253662
--------------- finish training step 12
12 821.7458672523499
step time = 18.600390672683716
--------------- finish training step 13
13 879.9301719665527
step time = 18.57701587677002
--------------- finish training step 14
14 938.7449312210083
step time = 18.697574615478516
--------------- finish training step 15
15 996.8560156822205
step time = 18.753479480743408
--------------- finish training step 16
16 1055.2936544418335
step time = 18.72821307182312
--------------- finish training step 17
17 1113.650264263153
step time = 18.480738162994385
--------------- finish training step 18
18 1172.1280798912048
step time = 18.248053312301636
--------------- finish training step 19
19 1229.496661901474
cuda 0: Peak memory 18.12 GB ; Persistent memory 3.30 GB
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   3374 MiB |  18559 MiB |   1570 GiB |   1567 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   3374 MiB |  18559 MiB |   1570 GiB |   1567 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   3374 MiB |  18446 MiB |   1565 GiB |   1562 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4146 MiB |  19736 MiB | 386172 MiB | 382026 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    771 MiB |   1080 MiB | 465214 MiB | 464443 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     197    |     790    |   72710    |   72513    |
|---------------------------------------------------------------------------|
| Active allocs         |     197    |     790    |   72710    |   72513    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     139    |     577    |   10123    |    9984    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      56    |      79    |   28996    |   28940    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

training time = 1229.4967288970947
cuda 3: Peak memory 14.68 GB ; Persistent memory 0.80 GB
cuda 1: Peak memory 14.12 GB ; Persistent memory 0.55 GB
cuda 2: Peak memory 14.12 GB ; Persistent memory 0.55 GB
num_iterations = 20
batch_size = 64
num_layers = 32
num_stages = 8
use_prefetch = False
step time = 23.53296160697937
--------------- finish training step 0
0 77.49955940246582
step time = 22.23126745223999
--------------- finish training step 1
1 141.22230553627014
step time = 22.730512857437134
--------------- finish training step 2
2 211.95583510398865
step time = 22.882915496826172
--------------- finish training step 3
3 280.39039158821106
step time = 19.194226026535034
--------------- finish training step 4
4 343.44962310791016
step time = 19.652443885803223
--------------- finish training step 5
5 407.216609954834
step time = 19.73197841644287
--------------- finish training step 6
6 471.59037494659424
step time = 19.678691387176514
--------------- finish training step 7
7 535.4801247119904
step time = 19.58760929107666
--------------- finish training step 8
8 599.254998922348
step time = 19.283612728118896
--------------- finish training step 9
9 662.7395868301392
step time = 20.258301973342896
--------------- finish training step 10
10 729.4503121376038
step time = 20.3509521484375
--------------- finish training step 11
11 795.1337962150574
step time = 20.559025287628174
--------------- finish training step 12
12 860.7982959747314
step time = 20.42425012588501
--------------- finish training step 13
13 925.2704739570618
step time = 20.448516845703125
--------------- finish training step 14
14 990.6466081142426
step time = 20.447324752807617
--------------- finish training step 15
15 1055.71058011055
step time = 20.395715951919556
--------------- finish training step 16
16 1121.2480461597443
step time = 20.650866508483887
--------------- finish training step 17
17 1187.3548674583435
step time = 20.26167941093445
--------------- finish training step 18
18 1252.5649244785309
step time = 20.615692615509033
--------------- finish training step 19
19 1318.4851989746094
cuda 0: Peak memory 16.71 GB ; Persistent memory 3.30 GB
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   3374 MiB |  17110 MiB |   1570 GiB |   1567 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   3374 MiB |  17110 MiB |   1570 GiB |   1567 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   3374 MiB |  16998 MiB |   1565 GiB |   1562 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4146 MiB |  18278 MiB | 383572 MiB | 379426 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    771 MiB |   1104 MiB | 453226 MiB | 452455 MiB |
|---------------------------------------------------------------------------|
| Allocations           |     197    |     789    |   72710    |   72513    |
|---------------------------------------------------------------------------|
| Active allocs         |     197    |     789    |   72710    |   72513    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     139    |     550    |   10081    |    9942    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      56    |      78    |   28395    |   28339    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

training time = 1318.4852530956268
cuda 1: Peak memory 14.09 GB ; Persistent memory 0.55 GB
cuda 2: Peak memory 14.09 GB ; Persistent memory 0.55 GB
cuda 3: Peak memory 14.48 GB ; Persistent memory 0.80 GB

num_iterations = 2
batch_size = 64
num_layers = 32
num_stages = 16
use_prefetch = True
use torch.cuda.empty_cache() 
step time = 18.517219305038452
--------------- finish training step 0
0 41.55141615867615
step time = 15.841724872589111
--------------- finish training step 1
1 32.867371559143066
step time = 18.57583451271057
--------------- finish training step 0
0 41.78457045555115
step time = 16.011448860168457
--------------- finish training step 1
1 35.34705948829651
step time = 20.603771924972534
--------------- finish training step 0
0 43.780696392059326
step time = 18.05439591407776
--------------- finish training step 1
1 34.6242949962616
step time = 20.484275817871094
--------------- finish training step 0
0 42.327237606048584
step time = 17.116278409957886
--------------- finish training step 1
1 34.7763876914978
step time = 20.540844917297363
--------------- finish training step 0
0 43.379218101501465
step time = 17.161545038223267
--------------- finish training step 1
1 34.12066292762756
cuda 3: Peak memory 14.06 GB ; Persistent memory 0.83 GB
cuda 2: Peak memory 13.61 GB ; Persistent memory 0.58 GB
cuda 0: Peak memory 14.00 GB ; Persistent memory 0.83 GB
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    847 MiB |  14337 MiB |    797 GiB |    796 GiB |
|---------------------------------------------------------------------------|
| Active memory         |    879 MiB |  14337 MiB |    797 GiB |    796 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |    879 MiB |  14216 MiB |    794 GiB |    793 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1458 MiB |  15990 MiB | 207774 MiB | 206316 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 262903 KiB | 745219 KiB | 160768 MiB | 160512 MiB |
|---------------------------------------------------------------------------|
| Allocations           |      16    |     651    |   36899    |   36883    |
|---------------------------------------------------------------------------|
| Active allocs         |      18    |     651    |   36899    |   36881    |
|---------------------------------------------------------------------------|
| GPU reserved segments |      39    |     489    |    5547    |    5508    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      18    |      70    |   13158    |   13140    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

training time = 39.79683995246887
cuda 1: Peak memory 13.61 GB ; Persistent memory 0.58 GB
num_iterations = 2
batch_size = 64
num_layers = 32
num_stages = 16
use_prefetch = True
no_torch.cuda.empty_cache() 
step time = 19.626851081848145
--------------- finish training step 0
0 39.788554668426514
step time = 15.197553396224976
--------------- finish training step 1
1 28.956820487976074
step time = 21.1134831905365
--------------- finish training step 0
0 42.11011862754822
step time = 17.465885877609253
--------------- finish training step 1
1 30.48852300643921
step time = 20.428915977478027
--------------- finish training step 0
0 40.99060940742493
step time = 17.301429510116577
--------------- finish training step 1
1 31.286482334136963
step time = 20.43492865562439
--------------- finish training step 0
0 40.16903519630432
step time = 16.966867446899414
--------------- finish training step 1
1 31.38250970840454
step time = 20.28310227394104
--------------- finish training step 0
0 41.459646701812744
step time = 17.115535497665405
--------------- finish training step 1
1 30.53616189956665
cuda 3: Peak memory 14.06 GB ; Persistent memory 0.83 GB
cuda 2: Peak memory 13.61 GB ; Persistent memory 0.58 GB
cuda 0: Peak memory 13.98 GB ; Persistent memory 0.83 GB
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 2         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    847 MiB |  14319 MiB |    797 GiB |    796 GiB |
|---------------------------------------------------------------------------|
| Active memory         |    879 MiB |  14319 MiB |    797 GiB |    796 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |    879 MiB |  14200 MiB |    794 GiB |    793 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  17038 MiB |  44094 MiB |  80222 MiB |  63184 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 246519 KiB | 714507 KiB | 134577 MiB | 134337 MiB |
|---------------------------------------------------------------------------|
| Allocations           |      16    |     651    |   36899    |   36883    |
|---------------------------------------------------------------------------|
| Active allocs         |      18    |     651    |   36899    |   36881    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     498    |    1349    |    2392    |    1894    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      19    |      77    |   11435    |   11416    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

training time = 34.59673357009888
cuda 1: Peak memory 13.61 GB ; Persistent memory 0.58 GB
num_iterations = 2
batch_size = 64
num_layers = 32
num_stages = 16
use_prefetch = True
no_torch.cuda.empty_cache()
no double grad
step time = 20.029049396514893
--------------- finish training step 0
0 37.349631547927856
step time = 15.670410394668579
--------------- finish training step 1
1 26.057650327682495
step time = 21.04940152168274
--------------- finish training step 0
0 37.12182903289795
step time = 17.17732310295105
--------------- finish training step 1
1 27.748504400253296
step time = 20.515952348709106
--------------- finish training step 0
0 39.72979283332825
step time = 17.481319665908813
--------------- finish training step 1
1 30.27822208404541
step time = 20.131664276123047
--------------- finish training step 0
0 37.549819231033325
step time = 18.00096035003662
--------------- finish training step 1
1 29.269670009613037
step time = 20.203652381896973
--------------- finish training step 0
0 38.7321937084198
step time = 17.309818506240845
--------------- finish training step 1
1 28.412774801254272
cuda 2: Peak memory 13.61 GB ; Persistent memory 0.58 GB
cuda 3: Peak memory 14.06 GB ; Persistent memory 0.83 GB
cuda 0: Peak memory 13.98 GB ; Persistent memory 0.83 GB
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 2         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    847 MiB |  14319 MiB |    797 GiB |    796 GiB |
|---------------------------------------------------------------------------|
| Active memory         |    879 MiB |  14319 MiB |    797 GiB |    796 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |    879 MiB |  14200 MiB |    794 GiB |    793 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  16966 MiB |  44112 MiB |  79690 MiB |  62724 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 246519 KiB | 726267 KiB | 134629 MiB | 134389 MiB |
|---------------------------------------------------------------------------|
| Allocations           |      16    |     651    |   36899    |   36883    |
|---------------------------------------------------------------------------|
| Active allocs         |      18    |     651    |   36899    |   36881    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     499    |    1351    |    2383    |    1884    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      19    |      78    |   11413    |   11394    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

training time = 29.63105273246765
cuda 1: Peak memory 13.61 GB ; Persistent memory 0.58 GB
num_iterations = 2
batch_size = 64
num_layers = 32
num_stages = 16
use_prefetch = True
num_iterations = 2
batch_size = 64
num_layers = 32
num_stages = 8
use_prefetch = True
step time = 4.771029233932495
--------------- finish training step 0
0 12.305164813995361
cuda 3: Peak memory 4.74 GB ; Persistent memory 0.78 GB
cuda 1: Peak memory 4.30 GB ; Persistent memory 0.54 GB
cuda 2: Peak memory 4.30 GB ; Persistent memory 0.54 GB
step time = 3.4600658416748047
--------------- finish training step 1
1 6.580275297164917
cuda 0: Peak memory 4.63 GB ; Persistent memory 1.03 GB
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1058 MiB |   4742 MiB |  42899 MiB |  41841 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   1058 MiB |   4742 MiB |  42899 MiB |  41841 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1058 MiB |   4716 MiB |  42782 MiB |  41724 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5850 MiB |   5850 MiB |   5850 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 130742 KiB | 301894 KiB |   7355 MiB |   7227 MiB |
|---------------------------------------------------------------------------|
| Allocations           |      35    |     192    |    1886    |    1851    |
|---------------------------------------------------------------------------|
| Active allocs         |      36    |     192    |    1886    |    1850    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     151    |     151    |     151    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      11    |      29    |     560    |     549    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

training time = 10.654146671295166
num_iterations = 2
batch_size = 64
num_layers = 32
num_stages = 8
use_prefetch = True
step time = 4.9288952350616455
--------------- finish training step 0
0 12.249064445495605
cuda 3: Peak memory 4.86 GB ; Persistent memory 0.78 GB
cuda 2: Peak memory 4.30 GB ; Persistent memory 0.54 GB
cuda 1: Peak memory 4.30 GB ; Persistent memory 0.54 GB
step time = 3.484476089477539
--------------- finish training step 1
1 6.468251943588257
cuda 0: Peak memory 4.63 GB ; Persistent memory 1.03 GB
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1058 MiB |   4744 MiB |  42901 MiB |  41843 MiB |
|---------------------------------------------------------------------------|
| Active memory         |   1058 MiB |   4744 MiB |  42901 MiB |  41843 MiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1058 MiB |   4717 MiB |  42782 MiB |  41724 MiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   5850 MiB |   5850 MiB |   5850 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 130742 KiB | 268078 KiB |   6777 MiB |   6649 MiB |
|---------------------------------------------------------------------------|
| Allocations           |      35    |     192    |    1886    |    1851    |
|---------------------------------------------------------------------------|
| Active allocs         |      36    |     192    |    1886    |    1850    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     151    |     151    |     151    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      11    |      29    |     557    |     546    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

training time = 10.303760766983032
